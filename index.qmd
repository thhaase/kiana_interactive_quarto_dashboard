---
title: "Umfrageergebnisse zum Nachhaltigen Wohnen"
format:
  dashboard:
#  html: 
#    toc: false
    theme: 
      - cosmo
      - custom.scss
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(crosstalk)
library(DT)
library(plotly)
library(RColorBrewer)
library(knitr)
library(tidyverse)
library(tidytext)

# load data ----
data <- read.csv("data.csv") %>% 
  mutate(ID = row_number()) %>% 
  select(-Zeitstempel)
  
# create shared data for crosstalk
shared_data <- SharedData$new(data, key = ~ID)
```


Wissen über nachhaltiges wohnen (1,6 und 9)
Umsetzung von n. W. (3,4,7,8) 
Interesse (2, 5 und 11) 
10 als eigene Gruppe vlt ?

Wissen und Interesse 1,2,5,6,9
Umsetzung 3,4,7,8,10

## Row {height=50%}

### Column {.tabset width=50%}

::: {.card title="1 Themen"}
An was denken Sie, wenn Sie den Begriff Nachhaltigkeit hören? 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tibble(response = data$An.was.denken.Sie..wenn.Sie.den.Begriff.Nachhaltigkeit.hören..) %>%
  mutate(themes = str_split(response, ";")) %>% 
  unnest(themes) %>% 
  count(themes, name = "Frequency") %>%
  mutate(themes = factor(themes, levels = themes[order(-Frequency)])) %>%  # Reorder factor levels
  plot_ly(x = ~themes, y = ~Frequency, type = 'bar', name = 'Sustainability Themes',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Greens')) %>%
  layout(title = '',
         xaxis = list(title = '', 
                      tickangle = -45),
         yaxis = list(title = 'Antworthäufigkeit'))
```
:::

::: {.card title="2 Wohnraum"}
Ist es für Sie wichtig Ihren Wohnraum und ihre Einrichtung nachhaltig zu gestalten?
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tibble(rating = data$Ist.es.für.Sie.wichtig.Ihren.Wohnraum.und.ihre.Einrichtung.nachhaltig.zu.gestalten.) %>%
  count(rating, name = "Frequency") %>%
#  mutate(rating = factor(rating, levels = rating[order(-Frequency)])) %>%
plot_ly(x = ~rating, y = ~Frequency, type = 'bar', name = 'Importance Ratings',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Greens')) %>%
  layout(title = '',
         xaxis = list(title = '',
                      tickvals = ~rating,
                      ticktext = c('1 \n Äußerst wichtig', '2', '3', '4 \n Überhaupt nicht wichtig'),
                      tickangle = -45),
         yaxis = list(title = 'Antworthäufigkeit'))

```
:::



::: {.card title="5 Workshop"}
Hätten Sie Interesse, an einem Upcycling-Workshop teilzunehmen?
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tibble(response = data$Hätten.Sie.Interesse..an.einem.Upcycling.Workshop.teilzunehmen.) %>%
  filter(response %in% c("Ja", "Nein")) %>% 
  count(response, name = "Frequency") %>%
  mutate(response = factor(response, levels = response[order(-Frequency)])) %>%
  plot_ly(x = ~response, y = ~Frequency, type = 'bar', name = 'Workshop Interest',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Viridis')) %>%
  layout(title = '',
         xaxis = list(title = '',
                      tickangle = -45),
         yaxis = list(title = 'Antworthäufigkeit'))

```
:::


::: {.card title="6 Wohnen"}
Wie haben Sie bisher Informationen darüber erhalten, wie man nachhaltig "Wohnen" kann?
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tibble(response = data$Wie.haben.Sie.bisher.Informationen.darüber.erhalten..wie.man.nachhaltig..Wohnen..kann.) %>%
  mutate(themes = str_split(response, ";")) %>% 
  unnest(themes) %>% 
  count(themes, name = "Frequency") %>%
    mutate(themes = recode(themes, "Ich habe bislang keine Informationen über nachhaltiges Wohnen erlangt." = "Bisher keine \nInformationen erhalten")) %>% 
  mutate(themes = factor(themes, levels = themes[order(-Frequency)])) %>%  # Reorder factor levels
  plot_ly(x = ~themes, y = ~Frequency, type = 'bar', name = 'Sustainability Themes',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Viridis')) %>%
  layout(title = '',
         xaxis = list(title = '', 
                      tickangle = -45),
         yaxis = list(title = 'Antworthäufigkeit'))


```
:::


::: {.card title="9 Verwendung"}

Wären Sie dafür, den Ressourcenverbrauch von Einrichtungsgegenständen auf den Produkten transparent zu machen?
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tibble(response = data$Wären.Sie.dafür..den.Ressourcenverbrauch.von.Einrichtungsgegenständen.auf.den.Produkten.transparent.zu.machen.) %>%
  filter(response %in% c("Ja", "Nein")) %>% 
  count(response, name = "Frequency") %>%
  mutate(response = factor(response, levels = response[order(-Frequency)])) %>%
  plot_ly(x = ~response, y = ~Frequency, type = 'bar', name = 'Transparency',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Viridis')) %>%
  layout(title = '',
         xaxis = list(title = '',
                      tickangle = -45),
         yaxis = list(title = 'Antworthäufigkeit'))

```
:::



::: {.card title="11 Zukunft"}
Ist es für Sie wichtig in der Zukunft, im Lebensbereich "Wohnen" Nachhaltigkeit zu integrieren?

```{r, echo=FALSE, message=FALSE, warning=FALSE}
data %>%
  mutate(response = factor(Ist.es.für.Sie.wichtig.in.der.Zukunft..im.Lebensbereich..Wohnen..Nachhaltigkeit.zu.integrieren..,
                           levels = c("1", "2", "3", "4"))) %>%
  count(response, name = "Frequency") %>%
  complete(response = c("1", "2", "3", "4"), fill = list(Frequency = 0)) %>%
  plot_ly(x = ~response, y = ~Frequency, type = 'bar', name = 'Sustainability',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Viridis')) %>%
  layout(title = '',
         xaxis = list(title = '',
                      tickangle = -45,
                      tickvals = ~response,
                      ticktext = c('1 \n Äußerst wichtig', '2', '3', '4 \n Überhaupt nicht wichtig')),
         yaxis = list(title = 'Antworthäufigkeit'))
```
:::







### Column {.tabset width=50%}

::: {.card title="3 Upcycling"}
Ist Ihnen der Begriff Upcycling im Bereich Wohnen bekannt?
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tibble(response = data$Ist.Ihnen.der.Begriff.Upcycling.im.Bereich.Wohnen.bekannt.) %>%
  mutate(response = recode(response, "Der Begriff ist mir bekannt, aber in anderen Lebensbereichen." = "Der Begriff ist mir bekannt, \naber in anderen Lebensbereichen.")) %>% 
  count(response, name = "Frequency") %>%
  mutate(response = factor(response, levels = response[order(-Frequency)])) %>%
  plot_ly(x = ~response, y = ~Frequency, type = 'bar', name = 'Upcycling Awareness',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Viridis')) %>%
  layout(title = '',
         xaxis = list(title = '',
                      tickangle = -45),
         yaxis = list(title = 'Antworthäufigkeit'))

```
:::

::: {.card title="4 Upcycling"}
Haben Sie in der Vergangenheit alte oder nutzlos gewordene Möbel, sowie Gegenstände selber aufgewertet, um ihre Lebensdauer zu verlängern?
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tibble(response = data$Haben.Sie.in.der.Vergangenheit.alte.oder.nutzlos.gewordene.Möbel..sowie.Gegenstände.selber.aufgewertet..um.ihre.Lebensdauer.zu.verlängern.) %>%
  count(response, name = "Frequency") %>%
  mutate(response = factor(response, levels = response[order(-Frequency)])) %>%
  plot_ly(x = ~response, y = ~Frequency, type = 'bar', name = 'Upcycling Behavior',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Viridis')) %>%
  layout(title = '',
         xaxis = list(title = '',
                      tickangle = -45),
         yaxis = list(title = 'Antworthäufigkeit'))
```
:::



::: {.card title="7 Verwendung"}
Haben Sie in der Vergangenheit gebrauchte Möbel (Second Hand Möbel) gekauft und verwendet?
```{r, echo=FALSE, message=FALSE, warning=FALSE}
tibble(response = data$Haben.Sie.in.der.Vergangenheit.gebrauchte.Möbel..Second.Hand.Möbel..gekauft.und.verwendet.) %>%
  count(response, name = "Frequency") %>%
  mutate(response = factor(response, levels = response[order(-Frequency)])) %>%
  plot_ly(x = ~response, y = ~Frequency, type = 'bar', name = 'Second Hand Furniture',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Viridis')) %>%
  layout(title = '',
         xaxis = list(title = '',
                      tickangle = -45),
         yaxis = list(title = 'Antworthäufigkeit'))

```
::: 

::: {.card title="8 Läden"}
Sind Ihnen Läden oder Märkte bekannt, in denen man nachhaltige Möbel, sowie gebrauchte Möbel kaufen könnte?

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tibble(response = data$Sind.Ihnen.Läden.oder.Märkte.bekannt..in.denen.man.nachhaltige.Möbel..sowie.gebrauchte.Möbel.kaufen.könnte.) %>%
  filter(response %in% c("Ja", "Nein")) %>% 
  count(response, name = "Frequency") %>%
  mutate(response = factor(response, levels = response[order(-Frequency)])) %>%
  plot_ly(x = ~response, y = ~Frequency, type = 'bar', name = 'Transparency',
          marker = list(color = ~-Frequency, 
                        colorscale = 'Viridis')) %>%
  layout(title = '',
         xaxis = list(title = '',
                      tickangle = -45),
         yaxis = list(title = 'Antworthäufigkeit'))

```
:::


::: {.card title="10 Wünsche"}
Zu welchem Thema im Bereich Wohnen würden Sie sich ein Angebot in Gießen wünschen (z.B. Informationen, Workshops)?
```{r, echo=FALSE, message=FALSE, warning=FALSE}
#| layout-ncol: 2

tibble(Antwort = data$Zu.welchem.Thema.im.Bereich.Wohnen.würden.Sie.sich.ein.Angebot.in.Gießen.wünschen..z.B..Informationen..Workshops..) %>% 
filter(Antwort != "" & !is.na(Antwort) & Antwort != "-") %>%
  select(Antwort) %>%
  mutate(Antwort = str_trim(Antwort)) %>% 
  filter(Antwort != "") %>% 
  datatable(data, 
            options = list(searching = FALSE, 
                           info = FALSE), 
            rownames = FALSE)


custom_stopwords <- data_frame(word = c("von","wie","die","z.b","nur","mit","man","kann",                    "ich", "ein", "alle", "aber"))

data %>%
  unnest_tokens(word, Zu.welchem.Thema.im.Bereich.Wohnen.würden.Sie.sich.ein.Angebot.in.Gießen.wünschen..z.B..Informationen..Workshops..) %>%  
  anti_join(custom_stopwords, by = "word") %>%
  count(word, sort = TRUE) %>%
  filter(n >= 2) %>%
  top_n(10, n) %>%
  mutate(word = str_to_title(word)) %>% 
ggplot(aes(x = reorder(word, n), y = n, fill = n)) +
  geom_col() +
  coord_flip() +
  scale_fill_gradient(low = "lightgreen", high = "darkgreen") +
  labs(x = "", y = "Anzahl", title = "Am häufigsten genannte Wörter") +
  theme(legend.position = "none")

```
:::
